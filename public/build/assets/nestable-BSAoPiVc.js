/*!
 * Nestable jQuery Plugin - Copyright (c) 2014 Ramon Smit - https://github.com/RamonSmit/Nestable
 */(function(i,m,f,v){var N="ontouchstart"in f,E=function(){var t=f.createElement("div"),e=f.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var l=m.getComputedStyle&&m.getComputedStyle(t,"").pointerEvents==="auto";return e.removeChild(t),!!l}(),b={contentCallback:function(t){return t.content?t.content:t.id},listNodeName:"ol",itemNodeName:"li",handleNodeName:"div",contentNodeName:"span",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",contentClass:"dd-content",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",noChildrenClass:"dd-nochildren",emptyClass:"dd-empty",expandBtnHTML:'<button class="dd-expand" data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button class="dd-collapse" data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20,fixedDepth:!1,fixed:!1,includeContent:!1,scroll:!1,scrollSensitivity:1,scrollSpeed:5,scrollTriggers:{top:40,left:40,right:-40,bottom:-40},effect:{animation:"none",time:"slow"},callback:function(t,e,l){},onDragStart:function(t,e,l){},beforeDragStop:function(t,e,l){},listRenderer:function(t,e){var l="<"+e.listNodeName+' class="'+e.listClass+'">';return l+=t,l+="</"+e.listNodeName+">",l},itemRenderer:function(t,e,l,n,r){var o=i.map(t,function(a,d){return" "+d+'="'+a+'"'}).join(" "),s="<"+n.itemNodeName+o+">";return s+="<"+n.handleNodeName+' class="'+n.handleClass+'">',s+="<"+n.contentNodeName+' class="'+n.contentClass+'">',s+=e,s+="</"+n.contentNodeName+">",s+="</"+n.handleNodeName+">",s+=l,s+="</"+n.itemNodeName+">",s}};function y(t,e){this.w=i(f),this.el=i(t),e=e||b,e.rootClass!==v&&e.rootClass!=="dd"&&(e.listClass=e.listClass?e.listClass:e.rootClass+"-list",e.itemClass=e.itemClass?e.itemClass:e.rootClass+"-item",e.dragClass=e.dragClass?e.dragClass:e.rootClass+"-dragel",e.handleClass=e.handleClass?e.handleClass:e.rootClass+"-handle",e.collapsedClass=e.collapsedClass?e.collapsedClass:e.rootClass+"-collapsed",e.placeClass=e.placeClass?e.placeClass:e.rootClass+"-placeholder",e.noDragClass=e.noDragClass?e.noDragClass:e.rootClass+"-nodrag",e.noChildrenClass=e.noChildrenClass?e.noChildrenClass:e.rootClass+"-nochildren",e.emptyClass=e.emptyClass?e.emptyClass:e.rootClass+"-empty"),this.options=i.extend({},b,e),this.options.json!==v&&this._build(),this.init()}y.prototype={init:function(){var t=this;t.reset(),t.el.data("nestable-group",this.options.group),t.placeEl=i('<div class="'+t.options.placeClass+'"/>');var e=this.el.find(t.options.itemNodeName);i.each(e,function(s,a){var d=i(a),h=d.parent();t.setParent(d),h.hasClass(t.options.collapsedClass)&&t.collapseItem(h.parent())}),e.length||this.appendEmptyElement(this.el),t.el.on("click","button",function(s){if(!t.dragEl){var a=i(s.currentTarget),d=a.data("action"),h=a.parents(t.options.itemNodeName).eq(0);d==="collapse"&&t.collapseItem(h),d==="expand"&&t.expandItem(h)}});var l=function(s){var a=i(s.target);if(!a.hasClass(t.options.handleClass)){if(a.closest("."+t.options.noDragClass).length)return;a=a.closest("."+t.options.handleClass)}!a.length||t.dragEl||(t.isTouch=/^touch/.test(s.type),!(t.isTouch&&s.touches.length!==1)&&(s.preventDefault(),t.dragStart(s.touches?s.touches[0]:s)))},n=function(s){t.dragEl&&(s.preventDefault(),t.dragMove(s.touches?s.touches[0]:s))},r=function(s){t.dragEl&&(s.preventDefault(),t.dragStop(s.touches?s.changedTouches[0]:s))};N&&(t.el[0].addEventListener("touchstart",l,!1),m.addEventListener("touchmove",n,!1),m.addEventListener("touchend",r,!1),m.addEventListener("touchcancel",r,!1)),t.el.on("mousedown",l),t.w.on("mousemove",n),t.w.on("mouseup",r);var o=function(){N&&(t.el[0].removeEventListener("touchstart",l,!1),m.removeEventListener("touchmove",n,!1),m.removeEventListener("touchend",r,!1),m.removeEventListener("touchcancel",r,!1)),t.el.off("mousedown",l),t.w.off("mousemove",n),t.w.off("mouseup",r),t.el.off("click"),t.el.unbind("destroy-nestable"),t.el.data("nestable",null)};t.el.bind("destroy-nestable",o)},destroy:function(){this.el.trigger("destroy-nestable")},add:function(t){var e="."+this.options.listClass,l=i(this.el).children(e);t.parent_id!==v&&(l=l.find('[data-id="'+t.parent_id+'"]'),delete t.parent_id,l.children(e).length===0&&(l=l.append(this.options.listRenderer("",this.options))),l=l.find(e+":first"),this.setParent(l.parent())),l.append(this._buildItem(t,this.options))},replace:function(t){var e=this._buildItem(t,this.options);this._getItemById(t.id).replaceWith(e)},removeItem:function(t){var e=this.options,l=this.el;t=t||this,t.remove();var n="."+e.listClass+" ."+e.listClass+":not(:has(*))";i(l).find(n).remove();var r='[data-action="expand"], [data-action="collapse"]';i(l).find(r).each(function(){var o=i(this).siblings("."+e.listClass);o.length===0&&i(this).remove()})},remove:function(t,e){var l=this.options,n=this,r=this._getItemById(t),o=l.effect.animation||"fade",s=l.effect.time||"slow";o==="fade"?r.fadeOut(s,function(){n.removeItem(r)}):this.removeItem(r),e&&e()},removeAll:function(t){var e=this,l=this.options,n=e.el.find(l.listNodeName).first(),r=n.children(l.itemNodeName),o=l.effect.animation||"fade",s=l.effect.time||"slow";function a(){r.each(function(){e.removeItem(i(this))}),n.show(),t&&t()}o==="fade"?n.fadeOut(s,a):a()},_getItemById:function(t){return i(this.el).children("."+this.options.listClass).find('[data-id="'+t+'"]')},_build:function(){var t=this.options.json;typeof t=="string"&&(t=JSON.parse(t)),i(this.el).html(this._buildList(t,this.options))},_buildList:function(t,e){if(!t)return"";var l="",n=this;return i.each(t,function(r,o){l+=n._buildItem(o,e)}),e.listRenderer(l,e)},_buildItem:function(t,e){function l(c){var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return c+"".replace(/[&<>"']/g,function(p){return u[p]})}function n(c){var u={};for(var p in c)u[c[p]]=c[p];return u}function r(c,u){var p=c.classes||{};typeof p=="string"&&(p=[p]);var g=n(p);return g[u.itemClass]=u.itemClass,i.map(g,function(C){return C}).join(" ")}function o(c){c=i.extend({},c),delete c.children,delete c.classes,delete c.content;var u={};return i.each(c,function(p,g){typeof g=="object"&&(g=JSON.stringify(g)),u["data-"+p]=l(g)}),u}var s=o(t);s.class=r(t,e);var a=e.contentCallback(t),d=this._buildList(t.children,e),h=i(e.itemRenderer(s,a,d,e,t));return this.setParent(h),h[0].outerHTML},serialize:function(){var t,e=this,l=function(n){var r=[],o=n.children(e.options.itemNodeName);return o.each(function(){var s=i(this),a=i.extend({},s.data()),d=s.children(e.options.listNodeName);if(e.options.includeContent){var h=s.find("."+e.options.contentClass).html();h&&(a.content=h)}d.length&&(a.children=l(d)),r.push(a)}),r};return t=l(e.el.find(e.options.listNodeName).first()),t},asNestedSet:function(){var t=this,e=t.options,l=-1,n=[],r=1,o=t.el.find(e.listNodeName).first().children(e.itemNodeName);return o.each(function(){r=s(this,l+1,r)}),n=n.sort(function(d,h){return d.lft-h.lft}),n;function s(d,h,c){var u=c+1,p,g;return i(d).children(e.listNodeName).children(e.itemNodeName).length>0&&(h++,i(d).children(e.listNodeName).children(e.itemNodeName).each(function(){u=s(i(this),h,u)}),h--),p=i(d).attr("data-id"),a(p)&&(p=parseInt(p)),g=i(d).parent(e.listNodeName).parent(e.itemNodeName).attr("data-id")||"",a(g)&&(p=parseInt(g)),p&&n.push({id:p,parent_id:g,depth:h,lft:c,rgt:u}),c=u+1,c}function a(d){return i.isNumeric(d)&&Math.floor(d)==d}},returnOptions:function(){return this.options},serialise:function(){return this.serialize()},toHierarchy:function(t){var e=i.extend({},this.options,t),l=[];return i(this.element).children(e.items).each(function(){var r=n(this);l.push(r)}),l;function n(r){var o=(i(r).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);if(o){var s={id:o[2]};return i(r).children(e.listType).children(e.items).length>0&&(s.children=[],i(r).children(e.listType).children(e.items).each(function(){var a=n(this);s.children.push(a)})),s}}},toArray:function(){var t=i.extend({},this.options,this),e=t.startDepthCount||0,l=[],n=2,r=this,o=r.el.find(r.options.listNodeName).first(),s=o.children(r.options.itemNodeName);return s.each(function(){n=a(i(this),e+1,n)}),l=l.sort(function(d,h){return d.left-h.left}),l;function a(d,h,c){var u=c+1,p,g;if(d.children(t.options.listNodeName).children(t.options.itemNodeName).length>0&&(h++,d.children(t.options.listNodeName).children(t.options.itemNodeName).each(function(){u=a(i(this),h,u)}),h--),p=d.data().id,h===e+1)g=t.rootID;else{var C=d.parent(t.options.listNodeName).parent(t.options.itemNodeName).data();g=C.id}return p&&l.push({id:p,parent_id:g,depth:h,left:c,right:u}),c=u+1,c}},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){var e=t.children(this.options.listNodeName);e.length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.expandItem(i(this))})},collapseAll:function(){var t=this;t.el.find(t.options.itemNodeName).each(function(){t.collapseItem(i(this))})},setParent:function(t){t.is(this.options.itemNodeName)&&t.children(this.options.listNodeName).length&&(t.children("[data-action]").remove(),t.prepend(i(this.options.expandBtnHTML)),t.prepend(i(this.options.collapseBtnHTML)))},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,l=i(t.target),n=l.closest(this.options.itemNodeName),r={top:t.pageY,left:t.pageX},o=this.options.onDragStart.call(this,this.el,n,r);if(!(typeof o<"u"&&o===!1)){this.placeEl.css("height",n.height()),e.offsetX=t.pageX-n.offset().left,e.offsetY=t.pageY-n.offset().top,e.startX=e.lastX=t.pageX,e.startY=e.lastY=t.pageY,this.dragRootEl=this.el,this.dragEl=i(f.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",n.outerWidth()),this.setIndexOfItem(n),n.after(this.placeEl),n[0].parentNode.removeChild(n[0]),n.appendTo(this.dragEl),i(f.body).append(this.dragEl),this.dragEl.css({left:t.pageX-e.offsetX,top:t.pageY-e.offsetY});var s,a,d=this.dragEl.find(this.options.itemNodeName);for(s=0;s<d.length;s++)a=i(d[s]).parents(this.options.listNodeName).length,a>this.dragDepth&&(this.dragDepth=a)}},createSubLevel:function(t,e){var l=i("<"+this.options.listNodeName+"/>").addClass(this.options.listClass);return e&&l.append(e),t.append(l),this.setParent(t),l},setIndexOfItem:function(t,e){e=e||[],e.unshift(t.index()),i(t[0].parentNode)[0]!==this.dragRootEl[0]?this.setIndexOfItem(i(t[0].parentNode),e):this.dragEl.data("indexOfItem",e)},restoreItemAtIndex:function(t,e){var l=this.el,n=e.length-1;function r(d,h){e[n]===0?i(d).prepend(h.clone(!0)):i(d.children[e[n]-1]).after(h.clone(!0))}for(var o=0;o<e.length;o++){if(n===parseInt(o)){r(l,t);return}var s=l[0]?l[0]:l,a=s.children[e[o]];l=a||this.createSubLevel(i(s))}},dragStop:function(t){var e={top:t.pageY,left:t.pageX},l=this.dragEl.data("indexOfItem"),n=this.dragEl.children(this.options.itemNodeName).first();n[0].parentNode.removeChild(n[0]),this.dragEl.remove();var r=this.options.beforeDragStop.call(this,this.el,n,this.placeEl.parent());if(typeof r<"u"&&r===!1){var o=this.placeEl.parent();this.placeEl.remove(),o.children().length||this.unsetParent(o.parent()),this.restoreItemAtIndex(n,l),this.reset();return}this.placeEl.replaceWith(n),this.hasNewRoot?(this.options.fixed===!0?this.restoreItemAtIndex(n,l):this.el.trigger("lostItem"),this.dragRootEl.trigger("gainedItem")):this.dragRootEl.trigger("change"),this.options.callback.call(this,this.dragRootEl,n,e),this.reset()},dragMove:function(t){var e,l,n,r,o,s=this.options,a=this.mouse;this.dragEl.css({left:t.pageX-a.offsetX,top:t.pageY-a.offsetY}),a.lastX=a.nowX,a.lastY=a.nowY,a.nowX=t.pageX,a.nowY=t.pageY,a.distX=a.nowX-a.lastX,a.distY=a.nowY-a.lastY,a.lastDirX=a.dirX,a.lastDirY=a.dirY,a.dirX=a.distX===0?0:a.distX>0?1:-1,a.dirY=a.distY===0?0:a.distY>0?1:-1;var d=Math.abs(a.distX)>Math.abs(a.distY)?1:0;if(!a.moving){a.dirAx=d,a.moving=!0;return}if(s.scroll)if(typeof m.jQuery.fn.scrollParent<"u"){var h=!1,c=this.el.scrollParent()[0];c!==f&&c.tagName!=="HTML"?(s.scrollTriggers.bottom+c.offsetHeight-t.pageY<s.scrollSensitivity?c.scrollTop=h=c.scrollTop+s.scrollSpeed:t.pageY-s.scrollTriggers.top<s.scrollSensitivity&&(c.scrollTop=h=c.scrollTop-s.scrollSpeed),s.scrollTriggers.right+c.offsetWidth-t.pageX<s.scrollSensitivity?c.scrollLeft=h=c.scrollLeft+s.scrollSpeed:t.pageX-s.scrollTriggers.left<s.scrollSensitivity&&(c.scrollLeft=h=c.scrollLeft-s.scrollSpeed)):(t.pageY-i(f).scrollTop()<s.scrollSensitivity?h=i(f).scrollTop(i(f).scrollTop()-s.scrollSpeed):i(m).height()-(t.pageY-i(f).scrollTop())<s.scrollSensitivity&&(h=i(f).scrollTop(i(f).scrollTop()+s.scrollSpeed)),t.pageX-i(f).scrollLeft()<s.scrollSensitivity?h=i(f).scrollLeft(i(f).scrollLeft()-s.scrollSpeed):i(m).width()-(t.pageX-i(f).scrollLeft())<s.scrollSensitivity&&(h=i(f).scrollLeft(i(f).scrollLeft()+s.scrollSpeed)))}else console.warn("To use scrolling you need to have scrollParent() function, check documentation for more information");this.scrollTimer&&clearTimeout(this.scrollTimer),s.scroll&&h&&(this.scrollTimer=setTimeout(function(){i(m).trigger(t)},10)),a.dirAx!==d?(a.distAxX=0,a.distAxY=0):(a.distAxX+=Math.abs(a.distX),a.dirX!==0&&a.dirX!==a.lastDirX&&(a.distAxX=0),a.distAxY+=Math.abs(a.distY),a.dirY!==0&&a.dirY!==a.lastDirY&&(a.distAxY=0)),a.dirAx=d,a.dirAx&&a.distAxX>=s.threshold&&(a.distAxX=0,n=this.placeEl.prev(s.itemNodeName),a.distX>0&&n.length&&!n.hasClass(s.collapsedClass)&&!n.hasClass(s.noChildrenClass)&&(e=n.find(s.listNodeName).last(),o=this.placeEl.parents(s.listNodeName).length,o+this.dragDepth<=s.maxDepth&&(e.length?(e=n.children(s.listNodeName).last(),e.append(this.placeEl)):this.createSubLevel(n,this.placeEl))),a.distX<0&&(r=this.placeEl.next(s.itemNodeName),r.length||(l=this.placeEl.parent(),this.placeEl.closest(s.itemNodeName).after(this.placeEl),l.children().length||this.unsetParent(l.parent()))));var u=!1;if(E||(this.dragEl[0].style.visibility="hidden"),this.pointEl=i(f.elementFromPoint(t.pageX-f.body.scrollLeft,t.pageY-(m.pageYOffset||f.documentElement.scrollTop))),E||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(s.handleClass)&&(this.pointEl=this.pointEl.closest(s.itemNodeName)),this.pointEl.hasClass(s.emptyClass))u=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(s.itemClass))return;var p=this.pointEl.closest("."+s.rootClass),g=this.dragRootEl.data("nestable-id")!==p.data("nestable-id");if(!a.dirAx||g||u){if(g&&s.group!==p.data("nestable-group")||this.options.fixedDepth&&this.dragDepth+1!==this.pointEl.parents(s.listNodeName).length||(o=this.dragDepth-1+this.pointEl.parents(s.listNodeName).length,o>s.maxDepth))return;var C=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;l=this.placeEl.parent(),u?(e=i(f.createElement(s.listNodeName)).addClass(s.listClass),e.append(this.placeEl),this.pointEl.replaceWith(e)):C?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),l.children().length||this.unsetParent(l.parent()),this.dragRootEl.find(s.itemNodeName).length||this.appendEmptyElement(this.dragRootEl),this.dragRootEl=p,g&&(this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}},appendEmptyElement:function(t){t.append('<div class="'+this.options.emptyClass+'"/>')}},i.fn.nestable=function(t){var e=this,l=this,n=arguments;return"Nestable"in m||(m.Nestable={},Nestable.counter=0),e.each(function(){var r=i(this).data("nestable");if(!r)Nestable.counter++,i(this).data("nestable",new y(this,t)),i(this).data("nestable-id",Nestable.counter);else if(typeof t=="string"&&typeof r[t]=="function")if(n.length>1){for(var o=[],s=1;s<n.length;s++)o.push(n[s]);l=r[t].apply(r,o)}else l=r[t]()}),l||e}})(window.jQuery||window.Zepto,window,document);(function(i){var m=function(){};m.prototype.updateOutput=function(f){var v=f.length?f:i(f.target),N=v.data("output");window.JSON?N.val(window.JSON.stringify(v.nestable("serialize"))):N.val("JSON browser support required for this demo.")},m.prototype.init=function(){i("#nestable_list_1").nestable({group:1}).on("change",this.updateOutput),i("#nestable_list_2").nestable({group:1}).on("change",this.updateOutput),this.updateOutput(i("#nestable_list_1").data("output",i("#nestable_list_1_output"))),this.updateOutput(i("#nestable_list_2").data("output",i("#nestable_list_2_output"))),i("#nestable_list_menu").on("click",function(f){var v=i(f.target),N=v.data("action");N==="expand-all"&&i(".dd").nestable("expandAll"),N==="collapse-all"&&i(".dd").nestable("collapseAll")}),i("#nestable_list_3").nestable()},i.Nestable=new m,i.Nestable.Constructor=m})(window.jQuery),function(i){i.Nestable.init()}(window.jQuery);
