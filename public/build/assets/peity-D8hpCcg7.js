(function(l,k,r,m){var s=l.fn.peity=function(t,i){return D&&this.each(function(){var e=l(this),h=e.data("_peity");h?(t&&(h.type=t),l.extend(h.opts,i)):(h=new _(e,t,l.extend({},s.defaults[t],e.data("peity"),i)),e.change(function(){h.draw()}).data("_peity",h)),h.draw()}),this},_=function(t,i,e){this.$el=t,this.type=i,this.opts=e},j=_.prototype,y=j.svgElement=function(t,i){return l(k.createElementNS("http://www.w3.org/2000/svg",t)).attr(i)},D="createElementNS"in k&&y("svg",{})[0].createSVGRect;j.draw=function(){var t=this.opts;s.graphers[this.type].call(this,t),t.after&&t.after.call(this,t)},j.fill=function(){var t=this.opts.fill;return l.isFunction(t)?t:function(i,e){return t[e%t.length]}},j.prepare=function(t,i){return this.$svg||this.$el.hide().after(this.$svg=y("svg",{class:"peity"})),this.$svg.empty().data("_peity",this).attr({height:i,width:t})},j.values=function(){return l.map(this.$el.text().split(this.opts.delimiter),function(t){return parseFloat(t)})},s.defaults={},s.graphers={},s.register=function(t,i,e){this.defaults[t]=i,this.graphers[t]=e},s.register("pie",{fill:["#ff9900","#fff4dd","#ffc66e"],radius:8},function(t){if(!t.delimiter){var i=this.$el.text().match(/[^0-9\.]/);t.delimiter=i?i[0]:","}var e=l.map(this.values(),function(R){return R>0?R:0});if(t.delimiter=="/"){var h=e[0],o=e[1];e=[h,r.max(0,o-h)]}for(var f=0,g=e.length,d=0;f<g;f++)d+=e[f];d||(g=2,d=1,e=[0,1]);var w=t.radius*2,S=this.prepare(t.width||w,t.height||w),P=S.width(),x=S.height(),a=P/2,u=x/2,c=r.min(a,u),n=t.innerRadius;this.type=="donut"&&!n&&(n=c*.5);var E=r.PI,A=this.fill(),C=this.scale=function(R,q){var z=R/d*E*2-E/2;return[q*r.cos(z)+a,q*r.sin(z)+u]},p=0;for(f=0;f<g;f++){var v=e[f],F=v/d,L;if(F!=0){if(F==1)if(n){var W=a-.01,I=u-c,N=u-n;L=y("path",{d:["M",a,I,"A",c,c,0,1,1,W,I,"L",W,N,"A",n,n,0,1,0,a,N].join(" "),"data-value":v})}else L=y("circle",{cx:a,cy:u,"data-value":v,r:c});else{var b=p+v,Q=["M"].concat(C(p,c),"A",c,c,0,F>.5?1:0,1,C(b,c),"L");n?Q=Q.concat(C(b,n),"A",n,n,0,F>.5?1:0,0,C(p,n)):Q.push(a,u),p+=v,L=y("path",{d:Q.join(" "),"data-value":v})}L.attr("fill",A.call(this,v,f,e)),S.append(L)}}}),s.register("donut",l.extend(!0,{},s.defaults.pie),function(t){s.graphers.pie.call(this,t)}),s.register("line",{delimiter:",",fill:"#c6d9fd",height:16,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(t){var i=this.values();i.length==1&&i.push(i[0]);for(var e=r.max.apply(r,t.max==m?i:i.concat(t.max)),h=r.min.apply(r,t.min==m?i:i.concat(t.min)),o=this.prepare(t.width,t.height),f=t.strokeWidth,g=o.width(),d=o.height()-f,w=e-h,S=this.x=function(c){return c*(g/(i.length-1))},P=this.y=function(c){var n=d;return w&&(n-=(c-h)/w*d),n+f/2},x=P(r.max(h,0)),a=[0,x],u=0;u<i.length;u++)a.push(S(u),P(i[u]));a.push(g,x),t.fill&&o.append(y("polygon",{fill:t.fill,points:a.join(" ")})),f&&o.append(y("polyline",{fill:"none",points:a.slice(2,a.length-2).join(" "),stroke:t.stroke,"stroke-width":f,"stroke-linecap":"square"}))}),s.register("bar",{delimiter:",",fill:["#4D89F9"],height:16,min:0,padding:.1,width:32},function(t){for(var i=this.values(),e=r.max.apply(r,t.max==m?i:i.concat(t.max)),h=r.min.apply(r,t.min==m?i:i.concat(t.min)),o=this.prepare(t.width,t.height),f=o.width(),g=o.height(),d=e-h,w=t.padding,S=this.fill(),P=this.x=function(v){return v*f/i.length},x=this.y=function(v){return g-(d?(v-h)/d*g:1)},a=0;a<i.length;a++){var u=P(a+w),c=P(a+1-w)-u,n=i[a],E=x(n),A=E,C=E,p;d?n<0?A=x(r.min(e,0)):C=x(r.max(h,0)):p=1,p=C-A,p==0&&(p=1,e>0&&d&&A--),o.append(y("rect",{"data-value":n,fill:S.call(this,n,a,i),x:u,y:A,width:c,height:p}))}})})(jQuery,document,Math);(function(l){var k=function(){};k.prototype.createLine=function(r,m,s,_,j){return l(r).peity("line",{fill:m,stroke:s,width:_,height:j}),l(r)},k.prototype.init=function(){var r=this.createLine(".updating-chart","#9261c6","#9261c6",120,40);setInterval(function(){var m=Math.round(Math.random()*10),s=r.text().split(",");s.shift(),s.push(m),r.text(s.join(",")).change()},1e3)},l.PeityChart=new k,l.PeityChart.Constructor=k})(window.jQuery),function(l){l.PeityChart.init()}(window.jQuery);
